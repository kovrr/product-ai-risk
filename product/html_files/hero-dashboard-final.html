<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Kovrr · AI Risk Management Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;500;600;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
<style>
  :root {
    --error-red: rgb(255, 35, 35);
    --warning-orange: rgb(255, 153, 0);
    --warning-yellow: rgb(251, 188, 9);
    --success-mint: rgb(160, 190, 170);
    --primary-slate: rgb(150, 160, 180);
    --primary-slate-light: rgb(170, 180, 200);
    --bg-white: rgb(255, 255, 255);
    --bg-light: rgb(245, 247, 255);
    --bg-gray: rgb(237, 242, 247);
    --text-dark: rgb(26, 32, 44);
    --text-medium-dark: rgb(48, 48, 69);
    --text-medium: rgb(74, 85, 104);
    --text-light: rgb(113, 118, 126);
    --divider: rgb(220, 229, 242);
    --border-gray: rgb(163, 173, 181);
    --shadow-sm: rgba(0, 0, 0, 0.05) 0px 1px 2px 0px;
    --shadow-md: rgba(0, 0, 0, 0.1) 0px 4px 20px 0px;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html, body { height: 100%; background: var(--bg-light); color: var(--text-medium-dark); font-family: "Source Sans Pro", Helvetica, Arial, sans-serif; font-size: 14px; line-height: 1.5; -webkit-font-smoothing: antialiased; }
  .app-container { display: flex; height: 100vh; flex-direction: column; }
  .main-layout { display: flex; flex: 1; overflow: hidden; }
  .main-content { flex: 1; overflow-y: auto; padding: 30px; width: 100%; }
  .tab-navigation { display: flex; gap: 8px; margin-bottom: 30px; border-bottom: 2px solid var(--divider); padding-bottom: 0; }
  .tab-button { background: none; border: none; padding: 12px 24px; font-size: 15px; font-weight: 600; color: var(--text-medium); cursor: pointer; border-bottom: 3px solid transparent; margin-bottom: -2px; transition: all 0.2s; font-family: "Source Sans Pro", sans-serif; }
  .tab-button:hover { color: var(--text-dark); background: rgba(150, 160, 180, 0.08); }
  .tab-button.active { color: var(--primary-slate); border-bottom-color: var(--primary-slate); }
  .tab-content { display: none; }
  .tab-content.active { display: block; }
  .intelligence-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; margin-bottom: 30px; }
  .intelligence-card { background: var(--bg-white); border-radius: 15px; padding: 24px; box-shadow: var(--shadow-sm); border: 1px solid var(--divider); min-height: 500px; }
  .intelligence-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid var(--divider); }
  .intelligence-card-title { font-size: 18px; font-weight: 700; color: var(--text-dark); }
  .intelligence-card-subtitle { font-size: 13px; color: var(--text-medium); margin-top: 4px; }
  .insight-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; background: rgba(255, 153, 0, 0.1); color: var(--warning-orange); }
  .insight-badge.critical { background: rgba(255, 35, 35, 0.1); color: var(--error-red); }
  .visualization-container { position: relative; width: 100%; height: 400px; }
  .chart-tooltip { position: fixed; background: var(--text-dark); color: white; padding: 10px 14px; border-radius: 6px; font-size: 12px; pointer-events: none; opacity: 0; transition: opacity 0.2s; z-index: 10000; box-shadow: var(--shadow-md); max-width: 320px; line-height: 1.5; }
  .chart-tooltip.visible { opacity: 1; }
  .dotmatrix-container { width: 100%; height: 100%; display: flex; flex-direction: column; }
  .dotmatrix-svg { flex: 1; }
  .dotmatrix-circle { cursor: pointer; transition: all 0.2s; }
  .dotmatrix-circle:hover { stroke-width: 2.5; filter: brightness(1.1); }
  .dotmatrix-label { font-size: 10px; font-weight: 600; fill: var(--text-medium); pointer-events: none; }
  .dotmatrix-label.risk-label { text-anchor: end; }
  .dotmatrix-legend { display: flex; gap: 16px; padding: 12px; background: var(--bg-light); border-radius: 8px; margin-top: 12px; flex-wrap: wrap; justify-content: center; }
  .legend-item { display: flex; align-items: center; gap: 6px; font-size: 11px; }
  .legend-circle { width: 14px; height: 14px; border-radius: 50%; border: 2px solid var(--border-gray); }
  .sankey-node rect { cursor: pointer; fill-opacity: 0.9; stroke: white; stroke-width: 1; }
  .sankey-node text { font-size: 10px; font-weight: 600; pointer-events: none; fill: var(--text-medium-dark); }
  .sankey-link { fill: none; stroke-opacity: 0.3; cursor: pointer; transition: stroke-opacity 0.2s; }
  .sankey-link:hover { stroke-opacity: 0.55; }
  .treemap-cell { cursor: pointer; transition: opacity 0.2s; }
  .treemap-cell:hover { opacity: 0.85; }
  .portfolio-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 40px; }
  .portfolio-card { background: var(--bg-white); border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); }
  .portfolio-card-title { font-size: 14px; font-weight: 600; color: var(--text-medium); margin-bottom: 16px; text-transform: uppercase; letter-spacing: 0.5px; }
  .portfolio-metric { font-size: 32px; font-weight: 700; color: var(--text-dark); margin-bottom: 8px; }
  .badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; }
  .badge-critical { background-color: rgba(255, 35, 35, 0.1); color: var(--error-red); }
  .badge-high { background-color: rgba(255, 153, 0, 0.1); color: var(--warning-orange); }
  .badge-medium { background-color: rgba(251, 188, 9, 0.1); color: var(--warning-yellow); }
  .badge-low { background-color: rgba(169, 180, 188, 0.1); color: var(--text-medium); }
  .metric-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; }
  .metric-item-label { font-size: 13px; color: var(--text-medium); }
  .metric-item-value { font-size: 14px; font-weight: 600; color: var(--text-dark); }
  .actionable-steps { list-style: none; padding: 0; margin: 0; }
  .actionable-steps li { font-size: 13px; color: var(--text-medium-dark); padding: 8px 0; padding-left: 20px; position: relative; line-height: 1.4; }
  .actionable-steps li:before { content: "→"; position: absolute; left: 0; color: var(--primary-slate); font-weight: 600; }
</style>
</head>
<body>
<div class="app-container">
<div class="main-layout">
<main class="main-content">
<div class="tab-navigation">
<button class="tab-button active" onclick="switchTab('intelligence')">Risk Intelligence</button>
<button class="tab-button" onclick="switchTab('portfolio')">Portfolio Health</button>
<button class="tab-button" onclick="switchTab('insights')">Kovrr Insights</button>
</div>

<div id="intelligence-tab" class="tab-content active">
<div class="intelligence-grid">
<div class="intelligence-card">
<div class="intelligence-card-header">
<div><div class="intelligence-card-title">Risk-Control Coverage Matrix</div><div class="intelligence-card-subtitle">Dot = Coverage | Color = Gap Status</div></div>
<span class="insight-badge critical">3 critical gaps</span>
</div>
<div class="visualization-container">
<div class="dotmatrix-container">
<svg id="dotmatrix-svg" class="dotmatrix-svg"></svg>
<div class="dotmatrix-legend">
<div class="legend-item"><div class="legend-circle" style="background: rgb(160, 190, 170);"></div><span>At Target (Gap 0)</span></div>
<div class="legend-item"><div class="legend-circle" style="background: rgba(255, 153, 0, 0.6);"></div><span>Has Gap (1-2)</span></div>
<div class="legend-item"><div class="legend-circle" style="background: rgba(255, 35, 35, 0.6);"></div><span>Critical Gap (2.5+)</span></div>
<div class="legend-item"><div class="legend-circle" style="background: var(--bg-gray);"></div><span>No Coverage</span></div>
</div>
</div>
<div id="dotmatrix-tooltip" class="chart-tooltip"></div>
</div>
</div>

<div class="intelligence-card">
<div class="intelligence-card-header">
<div><div class="intelligence-card-title">Asset Risk Flow</div><div class="intelligence-card-subtitle">How assets contribute to risk scenarios</div></div>
<span class="insight-badge">Shadow IT = 70% exposure</span>
</div>
<div class="visualization-container">
<svg id="sankey-diagram" style="width: 100%; height: 100%;"></svg>
<div id="sankey-tooltip" class="chart-tooltip"></div>
</div>
</div>

<div class="intelligence-card">
<div class="intelligence-card-header">
<div><div class="intelligence-card-title">Assurance Priorities</div><div class="intelligence-card-subtitle">Gap severity vs. risk impact</div></div>
<span class="insight-badge">5 urgent gaps</span>
</div>
<div class="visualization-container">
<canvas id="quadrant-chart" style="width: 100%; height: 100%;"></canvas>
</div>
</div>

<div class="intelligence-card">
<div class="intelligence-card-header">
<div><div class="intelligence-card-title">GenAI Module Exposure</div><div class="intelligence-card-subtitle">AAL breakdown by AI model/asset</div></div>
<span class="insight-badge critical">$9.1M total</span>
</div>
<div class="visualization-container">
<svg id="treemap-chart" style="width: 100%; height: 100%;"></svg>
<div id="treemap-tooltip" class="chart-tooltip"></div>
</div>
</div>
</div>
</div>

<div id="portfolio-tab" class="tab-content">
<h2 style="font-size: 20px; font-weight: 700; color: var(--text-dark); margin: 20px 0;">Portfolio Health</h2>
<div class="portfolio-grid">
<div class="portfolio-card">
<div class="portfolio-card-title">Assets Visibility</div>
<div class="portfolio-metric">12</div>
<div style="font-size: 13px; color: var(--text-medium);">Total AI Assets</div>
<div style="width: 120px; height: 120px; margin: 20px auto; border-radius: 50%; background: conic-gradient(rgb(160, 190, 170) 0% 66.67%, rgb(220, 180, 150) 66.67% 100%);"></div>
<div style="display: flex; flex-direction: column; gap: 8px; margin-top: 16px;">
<div style="display: flex; align-items: center; gap: 8px;"><div style="width: 12px; height: 12px; border-radius: 3px; background: rgb(160, 190, 170);"></div><span style="font-size: 13px; color: var(--text-medium); flex: 1;">Sanctioned</span><span style="font-size: 13px; font-weight: 600; color: var(--text-dark);">8</span></div>
<div style="display: flex; align-items: center; gap: 8px;"><div style="width: 12px; height: 12px; border-radius: 3px; background: rgb(220, 180, 150);"></div><span style="font-size: 13px; color: var(--text-medium); flex: 1;">Shadow IT</span><span style="font-size: 13px; font-weight: 600; color: var(--text-dark);">4</span></div>
</div>
<div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--divider);">
<div class="metric-item"><span class="metric-item-label">High Risk</span><span class="metric-item-value">3</span></div>
<div class="metric-item"><span class="metric-item-label">Avg Risk Score</span><span class="metric-item-value">70/100</span></div>
</div>
</div>

<div class="portfolio-card">
<div class="portfolio-card-title">Risk Register</div>
<div class="portfolio-metric">10</div>
<div style="font-size: 13px; color: var(--text-medium);">Total Scenarios</div>
<div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--divider);">
<div class="metric-item"><span class="metric-item-label"><span class="badge badge-critical">Critical</span></span><span class="metric-item-value">5</span></div>
<div class="metric-item"><span class="metric-item-label"><span class="badge badge-high">High</span></span><span class="metric-item-value">1</span></div>
<div class="metric-item"><span class="metric-item-label"><span class="badge badge-medium">Medium</span></span><span class="metric-item-value">2</span></div>
<div class="metric-item"><span class="metric-item-label"><span class="badge badge-low">Low</span></span><span class="metric-item-value">2</span></div>
</div>
</div>

<div class="portfolio-card">
<div class="portfolio-card-title">Compliance Readiness</div>
<div class="portfolio-metric">68%</div>
<div style="font-size: 13px; color: var(--text-medium);">NIST AI RMF Maturity</div>
<div style="height: 8px; background: var(--bg-gray); border-radius: 4px; overflow: hidden; margin: 16px 0;"><div style="height: 100%; width: 68%; background: linear-gradient(90deg, var(--primary-slate), var(--primary-slate-light));"></div></div>
<div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--divider);">
<div class="metric-item"><span class="metric-item-label">Controls Assessed</span><span class="metric-item-value">73</span></div>
<div class="metric-item"><span class="metric-item-label">Critical Gaps</span><span class="metric-item-value">5</span></div>
<div class="metric-item"><span class="metric-item-label">Target: Q1 2026</span><span class="metric-item-value">85%</span></div>
</div>
</div>

<div class="portfolio-card">
<div class="portfolio-card-title">Assurance Plan</div>
<div class="portfolio-metric">19</div>
<div style="font-size: 13px; color: var(--text-medium);">Total Controls in Assessment</div>
<div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--divider);">
<div class="metric-item"><span class="metric-item-label">Completed</span><span class="metric-item-value">12</span></div>
<div class="metric-item"><span class="metric-item-label">In Progress</span><span class="metric-item-value">5</span></div>
<div class="metric-item"><span class="metric-item-label">Draft</span><span class="metric-item-value">2</span></div>
</div>
<div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--divider);">
<div style="font-size: 13px; color: var(--text-medium); margin-bottom: 8px;">Gap Analysis</div>
<div class="metric-item"><span class="metric-item-label">Avg Gap Score</span><span class="metric-item-value">1.4</span></div>
<div class="metric-item"><span class="metric-item-label">At Target</span><span class="metric-item-value">8</span></div>
<div class="metric-item"><span class="metric-item-label">With Gap</span><span class="metric-item-value">11</span></div>
</div>
</div>

<div class="portfolio-card">
<div class="portfolio-card-title">GenAI Exposure</div>
<div class="portfolio-metric">$6.2M</div>
<div style="font-size: 13px; color: var(--text-medium);">Annual Average Loss</div>
<div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--divider);">
<div class="metric-item"><span class="metric-item-label">Model</span><span class="metric-item-value" style="font-size: 12px;">OpenAI GPT-4 Turbo</span></div>
<div class="metric-item"><span class="metric-item-label">Last Evaluated</span><span class="metric-item-value" style="font-size: 12px;">Nov 8, 2025</span></div>
<div class="metric-item"><span class="metric-item-label">1-in-100 Year Loss</span><span class="metric-item-value">$85M</span></div>
<div class="metric-item"><span class="metric-item-label">Annual Likelihood</span><span class="metric-item-value">68%</span></div>
</div>
</div>
</div>
</div>

<div id="insights-tab" class="tab-content">
<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 20px;">
<div style="width: 28px; height: 28px; background: linear-gradient(135deg, var(--primary-slate), var(--primary-slate-light)); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
<svg viewBox="0 0 24 24" style="width: 16px; height: 16px; stroke: white; fill: none; stroke-width: 2;"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
</div>
<h2 style="font-size: 24px; font-weight: 700; color: var(--text-dark);">Kovrr Insights</h2>
<span style="font-size: 13px; color: var(--text-medium); margin-left: auto;">AI-powered recommendations</span>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
<div style="background: var(--bg-white); border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); border: 1px solid var(--divider);">
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--divider);">
<div style="font-size: 16px; font-weight: 700; color: var(--text-dark);">Assets Visibility</div>
<div class="badge badge-critical">Critical</div>
</div>
<ul class="actionable-steps">
<li>Investigate 4 Shadow IT assets detected in recent discovery scan</li>
<li>Implement automated asset tagging for GenAI tools</li>
<li>Review high-risk asset GPT-4 API for policy violations</li>
</ul>
</div>

<div style="background: var(--bg-white); border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); border: 1px solid var(--divider);">
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--divider);">
<div style="font-size: 16px; font-weight: 700; color: var(--text-dark);">Risk Register</div>
<div class="badge badge-critical">Critical</div>
</div>
<ul class="actionable-steps">
<li>Address 2 "Severe/Expected" scenarios requiring immediate mitigation</li>
<li>Update likelihood assessment for Data Leakage scenario based on recent incidents</li>
<li>Assign owners to 2 unassigned critical risk scenarios</li>
</ul>
</div>

<div style="background: var(--bg-white); border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); border: 1px solid var(--divider);">
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--divider);">
<div style="font-size: 16px; font-weight: 700; color: var(--text-dark);">Compliance Readiness</div>
<div class="badge badge-high">High</div>
</div>
<ul class="actionable-steps">
<li>Close 5 critical control gaps to reach 75% maturity milestone</li>
<li>Focus on GOVERN function: 3 of 5 gaps are governance-related</li>
<li>Schedule Q1 2026 readiness review with compliance team</li>
</ul>
</div>

<div style="background: var(--bg-white); border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); border: 1px solid var(--divider);">
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--divider);">
<div style="font-size: 16px; font-weight: 700; color: var(--text-dark);">Assurance Plan</div>
<div class="badge badge-medium">Medium</div>
</div>
<ul class="actionable-steps">
<li>Complete 5 in-progress control assessments before month-end</li>
<li>Prioritize controls mapped to Critical risks (4 controls pending)</li>
<li>Review gap analysis for 11 controls not meeting target maturity</li>
</ul>
</div>

<div style="background: var(--bg-white); border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); border: 1px solid var(--divider);">
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--divider);">
<div style="font-size: 16px; font-weight: 700; color: var(--text-dark);">GenAI Exposure</div>
<div class="badge badge-critical">Critical</div>
</div>
<ul class="actionable-steps">
<li>$6.2M annual exposure concentrated in Prompt Injection ($2.8M) and Data Leakage ($2.1M)</li>
<li>Implement technical controls: only 2 of 19 assessed controls address GenAI risks</li>
<li>68% annual likelihood suggests incident within next 12 months</li>
</ul>
</div>

<div style="background: var(--bg-white); border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); border: 1px solid var(--divider);">
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--divider);">
<div style="font-size: 16px; font-weight: 700; color: var(--text-dark);">Integration Health</div>
<div class="badge badge-low">Low</div>
</div>
<ul class="actionable-steps">
<li>Renew 2 expiring API tokens before they impact data sync</li>
<li>Complete setup for 2 pending integrations (Jira, Slack)</li>
<li>All connected systems operational with healthy API status</li>
</ul>
</div>
</div>
</div>

</main>
</div>
</div>
<script>
function switchTab(tabName) {
  document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
  document.getElementById(tabName + '-tab').classList.add('active');
  event.target.classList.add('active');
  if (tabName === 'intelligence' && !window.chartsInitialized) initializeCharts();
}

window.chartsInitialized = false;
window.addEventListener('DOMContentLoaded', () => initializeCharts());

function initializeCharts() {
  if (window.chartsInitialized) return;
  window.chartsInitialized = true;
  initDotMatrix();
  initSankey();
  initQuadrant();
  initTreemap();
}

// DOT MATRIX
function initDotMatrix() {
  const risks = [
    { id: 'AIR-001', name: 'Payment Fraud' },
    { id: 'AIR-002', name: 'Biased Pricing' },
    { id: 'AIR-003', name: 'Supply Chain' },
    { id: 'AIR-004', name: 'Prompt Injection' },
    { id: 'AIR-005', name: 'Med Hallucination' }
  ];
  const controls = [
    { id: 'GOVERN 1.1', gap: 1.0 }, { id: 'GOVERN 1.6', gap: 3.0 }, { id: 'GOVERN 2.2', gap: 1.0 },
    { id: 'MAP 3.1', gap: 0 }, { id: 'MEASURE 2.1', gap: 1.0 }, { id: 'MEASURE 2.7', gap: 3.0 },
    { id: 'MEASURE 2.11', gap: 3.0 }, { id: 'MANAGE 4.1', gap: 2.0 }
  ];
  const coverage = {
    'AIR-001': ['GOVERN 2.2', 'MAP 3.1', 'MEASURE 2.1', 'MANAGE 4.1'],
    'AIR-002': ['GOVERN 1.1', 'MEASURE 2.11'],
    'AIR-003': ['GOVERN 2.2', 'MEASURE 2.1'],
    'AIR-004': ['GOVERN 1.1', 'MAP 3.1'],
    'AIR-005': ['GOVERN 1.6', 'MEASURE 2.7', 'MANAGE 4.1']
  };
  
  const width = 550, height = 370;
  const margin = { top: 20, right: 80, bottom: 20, left: 100 };
  const gridWidth = width - margin.left - margin.right;
  const gridHeight = height - margin.top - margin.bottom;
  const cellWidth = gridWidth / controls.length;
  const cellHeight = gridHeight / risks.length;
  const dotRadius = Math.min(cellWidth, cellHeight) * 0.35;
  
  const svg = d3.select('#dotmatrix-svg')
    .attr('viewBox', `0 0 ${width} ${height}`)
    .append('g')
    .attr('transform', `translate(${margin.left},${margin.top})`);
  
  svg.selectAll('.control-label').data(controls).join('text')
    .attr('class', 'dotmatrix-label')
    .attr('x', (d,i) => i * cellWidth + cellWidth/2)
    .attr('y', -5)
    .attr('text-anchor', 'end')
    .attr('transform', (d,i) => `rotate(-45, ${i * cellWidth + cellWidth/2}, -5)`)
    .text(d => d.id);
  
  svg.selectAll('.risk-label').data(risks).join('text')
    .attr('class', 'dotmatrix-label risk-label')
    .attr('x', -10)
    .attr('y', (d,i) => i * cellHeight + cellHeight/2 + 4)
    .text(d => d.id);
  
  risks.forEach((risk, i) => {
    controls.forEach((control, j) => {
      const hasCoverage = coverage[risk.id] && coverage[risk.id].includes(control.id);
      let fillColor, strokeColor;
      if (!hasCoverage) {
        fillColor = 'rgb(237, 242, 247)';
        strokeColor = 'rgb(220, 229, 242)';
      } else if (control.gap === 0) {
        fillColor = 'rgb(160, 190, 170)';
        strokeColor = 'rgb(140, 170, 150)';
      } else if (control.gap >= 2.5) {
        fillColor = 'rgba(255, 35, 35, 0.6)';
        strokeColor = 'rgb(255, 35, 35)';
      } else {
        fillColor = 'rgba(255, 153, 0, 0.6)';
        strokeColor = 'rgb(255, 153, 0)';
      }
      
      const circle = svg.append('circle')
        .attr('class', 'dotmatrix-circle')
        .attr('cx', j * cellWidth + cellWidth/2)
        .attr('cy', i * cellHeight + cellHeight/2)
        .attr('r', hasCoverage ? dotRadius : dotRadius * 0.5)
        .attr('fill', fillColor)
        .attr('stroke', strokeColor)
        .attr('stroke-width', hasCoverage ? 2 : 1);
      
      circle.on('mouseover', function(event) {
        const tooltip = document.getElementById('dotmatrix-tooltip');
        if (hasCoverage) {
          let status = 'At Target';
          if (control.gap >= 2.5) status = 'Critical Gap';
          else if (control.gap > 0) status = 'Has Gap';
          tooltip.innerHTML = `<strong>${risk.id}</strong> → <strong>${control.id}</strong><br/>${risk.name}<br/>Status: ${status}<br/>Gap: ${control.gap}`;
        } else {
          tooltip.innerHTML = `<strong>${risk.id}</strong> → <strong>${control.id}</strong><br/>No Coverage`;
        }
        tooltip.classList.add('visible');
        tooltip.style.left = event.clientX + 15 + 'px';
        tooltip.style.top = event.clientY + 15 + 'px';
        d3.select(this).transition().duration(200).attr('r', hasCoverage ? dotRadius * 1.3 : dotRadius * 0.7);
      })
      .on('mousemove', function(event) {
        const tooltip = document.getElementById('dotmatrix-tooltip');
        tooltip.style.left = event.clientX + 15 + 'px';
        tooltip.style.top = event.clientY + 15 + 'px';
      })
      .on('mouseout', function() {
        document.getElementById('dotmatrix-tooltip').classList.remove('visible');
        d3.select(this).transition().duration(200).attr('r', hasCoverage ? dotRadius : dotRadius * 0.5);
      });
    });
  });
}

// SANKEY - Full transparent flow
function initSankey() {
  const width = 550, height = 400;
  const margin = { top: 10, right: 10, bottom: 10, left: 10 };
  
  const nodes = [
    { name: 'GPT-4 (78)', layer: 0, status: 'Sanctioned', score: 78, aal: 6200000 },
    { name: 'Llama (82)', layer: 0, status: 'Shadow IT', score: 82 },
    { name: 'HuggingFace (92)', layer: 0, status: 'Shadow IT', score: 92 },
    { name: 'Fraud ML (85)', layer: 0, status: 'Sanctioned', score: 85 },
    { name: 'Security', layer: 1 },
    { name: 'Bias/Fairness', layer: 1 },
    { name: 'Legal', layer: 1 },
    { name: 'AIR-001 (4.5)', layer: 2, priority: 'Critical', lxi: 4.5 },
    { name: 'AIR-002 (4.0)', layer: 2, priority: 'Critical', lxi: 4.0 },
    { name: 'AIR-003 (3.5)', layer: 2, priority: 'Critical', lxi: 3.5 },
    { name: 'AIR-004 (3.0)', layer: 2, priority: 'High', lxi: 3.0 },
    { name: 'AIR-006 (2.5)', layer: 2, priority: 'Medium', lxi: 2.5 }
  ];
  
  const links = [
    { source: 0, target: 4, value: 78 },
    { source: 0, target: 6, value: 78 },
    { source: 1, target: 5, value: 82 },
    { source: 2, target: 4, value: 92 },
    { source: 3, target: 4, value: 85 },
    { source: 4, target: 7, value: 85 },
    { source: 4, target: 9, value: 92 },
    { source: 4, target: 10, value: 70 },
    { source: 5, target: 8, value: 82 },
    { source: 6, target: 11, value: 78 }
  ];
  
  const svg = d3.select('#sankey-diagram').attr('viewBox', `0 0 ${width} ${height}`);
  
  const sankey = d3.sankey()
    .nodeWidth(15)
    .nodePadding(10)
    .extent([[margin.left, margin.top], [width - margin.right, height - margin.bottom]]);
  
  const { nodes: sankeyNodes, links: sankeyLinks } = sankey({
    nodes: nodes.map(d => Object.assign({}, d)),
    links: links.map(d => Object.assign({}, d))
  });
  
  const statusColor = d => d === 'Sanctioned' ? 'rgb(160, 190, 170)' : 'rgb(220, 180, 150)';
  const priorityColor = d => {
    if (d === 'Critical') return 'rgb(210, 140, 140)';
    if (d === 'High') return 'rgb(220, 180, 150)';
    return 'rgb(170, 180, 190)';
  };
  
  svg.append('g')
    .selectAll('path')
    .data(sankeyLinks)
    .join('path')
    .attr('d', d3.sankeyLinkHorizontal())
    .attr('stroke', d => {
      const sourceNode = sankeyNodes[d.source.index];
      return sourceNode.status ? statusColor(sourceNode.status) : 'rgb(190, 195, 200)';
    })
    .attr('stroke-width', d => Math.max(1, d.width))
    .attr('stroke-opacity', 0.3)
    .attr('fill', 'none')
    .style('cursor', 'pointer')
    .on('mouseover', function(event, d) {
      const tooltip = document.getElementById('sankey-tooltip');
      const src = d.source;
      const tgt = d.target;
      tooltip.innerHTML = `<strong>${src.name}</strong> → <strong>${tgt.name}</strong><br/>Flow Value: ${d.value}`;
      tooltip.classList.add('visible');
      tooltip.style.left = event.clientX + 15 + 'px';
      tooltip.style.top = event.clientY + 15 + 'px';
      d3.select(this).attr('stroke-opacity', 0.55);
    })
    .on('mousemove', function(event) {
      const tooltip = document.getElementById('sankey-tooltip');
      tooltip.style.left = event.clientX + 15 + 'px';
      tooltip.style.top = event.clientY + 15 + 'px';
    })
    .on('mouseout', function() {
      document.getElementById('sankey-tooltip').classList.remove('visible');
      d3.select(this).attr('stroke-opacity', 0.3);
    });
  
  const node = svg.append('g').selectAll('g').data(sankeyNodes).join('g');
  
  node.append('rect')
    .attr('x', d => d.x0)
    .attr('y', d => d.y0)
    .attr('height', d => d.y1 - d.y0)
    .attr('width', d => d.x1 - d.x0)
    .attr('fill', d => {
      if (d.status) return statusColor(d.status);
      if (d.layer === 1) return 'rgb(150, 160, 180)';
      if (d.priority) return priorityColor(d.priority);
      return 'rgb(190, 195, 200)';
    });
  
  node.append('text')
    .attr('x', d => d.x0 < width / 2 ? d.x1 + 6 : d.x0 - 6)
    .attr('y', d => (d.y1 + d.y0) / 2)
    .attr('dy', '0.35em')
    .attr('text-anchor', d => d.x0 < width / 2 ? 'start' : 'end')
    .text(d => d.name)
    .style('font-size', '10px')
    .style('font-weight', '600')
    .style('fill', 'rgb(74, 85, 104)');
}

// QUADRANT - All 10 controls
function initQuadrant() {
  const ctx = document.getElementById('quadrant-chart').getContext('2d');
  const controlsData = [
    { name: 'GOVERN 1.6', gap: 3.0, impact: 95, size: 1, status: 'Draft' },
    { name: 'MEASURE 2.11', gap: 3.0, impact: 90, size: 1, status: 'In Progress' },
    { name: 'GOVERN 3.1', gap: 2.0, impact: 90, size: 1, status: 'In Progress' },
    { name: 'MANAGE 2.1', gap: 2.0, impact: 85, size: 1, status: 'Draft' },
    { name: 'MANAGE 4.1', gap: 2.0, impact: 95, size: 2, status: 'Completed' },
    { name: 'MAP 3.1', gap: 0, impact: 95, size: 2, status: 'Completed' },
    { name: 'GOVERN 1.1', gap: 1.0, impact: 75, size: 2, status: 'In Progress' },
    { name: 'MEASURE 2.1', gap: 1.0, impact: 70, size: 5, status: 'In Progress' },
    { name: 'GOVERN 2.2', gap: 1.0, impact: 88, size: 2, status: 'In Progress' },
    { name: 'MAP 2.2', gap: 1.0, impact: 80, size: 2, status: 'In Progress' }
  ];
  
  const statusColors = {
    'Draft': 'rgba(190, 195, 200, 0.45)',
    'In Progress': 'rgba(220, 180, 150, 0.45)',
    'Completed': 'rgba(160, 190, 170, 0.45)'
  };
  
  const statusBorders = {
    'Draft': 'rgb(190, 195, 200)',
    'In Progress': 'rgb(220, 180, 150)',
    'Completed': 'rgb(160, 190, 170)'
  };
  
  new Chart(ctx, {
    type: 'bubble',
    data: {
      datasets: [{
        label: 'Controls',
        data: controlsData.map(c => ({
          x: c.gap,
          y: c.impact,
          r: c.size * 4 + 6,
          name: c.name,
          status: c.status
        })),
        backgroundColor: controlsData.map(c => statusColors[c.status]),
        borderColor: controlsData.map(c => statusBorders[c.status]),
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: function(context) {
              const d = context.raw;
              return [
                `Control: ${d.name}`,
                `Gap Score: ${d.x}`,
                `Risk Impact: ${d.y}/100`,
                `Status: ${d.status}`
              ];
            }
          },
          backgroundColor: 'rgb(26, 32, 44)',
          titleColor: 'white',
          bodyColor: 'white',
          padding: 12,
          displayColors: false
        }
      },
      scales: {
        x: {
          title: { display: true, text: 'Gap Score', font: { size: 11, weight: '600' }, color: 'rgb(74, 85, 104)' },
          min: 0,
          max: 3,
          ticks: { stepSize: 0.5, color: 'rgb(113, 118, 126)', font: { size: 10 } },
          grid: { color: 'rgba(220, 229, 242, 0.3)' }
        },
        y: {
          title: { display: true, text: 'Risk Impact', font: { size: 11, weight: '600' }, color: 'rgb(74, 85, 104)' },
          min: 0,
          max: 100,
          ticks: { color: 'rgb(113, 118, 126)', font: { size: 10 } },
          grid: { color: 'rgba(220, 229, 242, 0.3)' }
        }
      }
    }
  });
}

// TREEMAP - BY GENAI MODULES (Assets)
function initTreemap() {
  const width = 550, height = 400;
  
  // GenAI MODULES = The actual AI assets/models
  const data = {
    name: 'GenAI Modules',
    children: [
      { 
        name: 'GPT-4 Turbo', 
        fullName: 'OpenAI GPT-4 Turbo',
        value: 6200000, 
        aal: 6.2,
        percentage: 68,
        status: 'Sanctioned',
        riskScore: 78,
        coverage: 'medium'
      },
      { 
        name: 'Claude 3', 
        fullName: 'Anthropic Claude 3',
        value: 1800000, 
        aal: 1.8,
        percentage: 20,
        status: 'Sanctioned',
        riskScore: 72,
        coverage: 'good'
      },
      { 
        name: 'Llama 3.1', 
        fullName: 'Meta Llama 3.1',
        value: 800000, 
        aal: 0.8,
        percentage: 9,
        status: 'Shadow IT',
        riskScore: 82,
        coverage: 'poor'
      },
      { 
        name: 'Gemini Pro', 
        fullName: 'Google Gemini Pro',
        value: 300000, 
        aal: 0.3,
        percentage: 3,
        status: 'Sanctioned',
        riskScore: 65,
        coverage: 'good'
      }
    ]
  };
  
  const svg = d3.select('#treemap-chart').attr('viewBox', `0 0 ${width} ${height}`);
  const root = d3.hierarchy(data).sum(d => d.value).sort((a,b) => b.value - a.value);
  d3.treemap().size([width, height]).padding(2).round(true)(root);
  
  const coverageColor = d => {
    if (d === 'poor') return 'rgb(210, 140, 140)';
    if (d === 'medium') return 'rgb(220, 180, 150)';
    return 'rgb(160, 190, 170)';
  };
  
  const cell = svg.selectAll('g').data(root.leaves()).join('g')
    .attr('transform', d => `translate(${d.x0},${d.y0})`);
  
  cell.append('rect')
    .attr('width', d => d.x1 - d.x0)
    .attr('height', d => d.y1 - d.y0)
    .attr('fill', d => coverageColor(d.data.coverage))
    .attr('stroke', 'white')
    .attr('stroke-width', 2)
    .style('cursor', 'pointer')
    .on('mouseover', function(event, d) {
      const tooltip = document.getElementById('treemap-tooltip');
      tooltip.innerHTML = `
        <strong>${d.data.name}</strong><br/>
        ${d.data.fullName}<br/>
        AAL: $${d.data.aal}M (${d.data.percentage}%)<br/>
        Status: ${d.data.status}<br/>
        Risk Score: ${d.data.riskScore}/100<br/>
        Coverage: ${d.data.coverage}
      `;
      tooltip.classList.add('visible');
      tooltip.style.left = event.clientX + 15 + 'px';
      tooltip.style.top = event.clientY + 15 + 'px';
      d3.select(this).style('opacity', 0.85);
    })
    .on('mousemove', function(event) {
      const tooltip = document.getElementById('treemap-tooltip');
      tooltip.style.left = event.clientX + 15 + 'px';
      tooltip.style.top = event.clientY + 15 + 'px';
    })
    .on('mouseout', function() {
      document.getElementById('treemap-tooltip').classList.remove('visible');
      d3.select(this).style('opacity', 1);
    });
  
  // Module name
  cell.append('text').attr('x', 5).attr('y', 18)
    .text(d => d.data.name)
    .attr('fill', 'white')
    .style('font-size', '11px')
    .style('font-weight', '700')
    .style('pointer-events', 'none');
  
  // Full name
  cell.append('text').attr('x', 5).attr('y', 32)
    .text(d => d.data.fullName)
    .attr('fill', 'rgba(255,255,255,0.9)')
    .style('font-size', '9px')
    .style('pointer-events', 'none');
  
  // AAL amount
  cell.append('text').attr('x', 5).attr('y', 52)
    .text(d => `$${d.data.aal}M AAL`)
    .attr('fill', 'white')
    .style('font-size', '14px')
    .style('font-weight', '700')
    .style('pointer-events', 'none');
  
  // Percentage
  cell.append('text').attr('x', 5).attr('y', 67)
    .text(d => `${d.data.percentage}% of total`)
    .attr('fill', 'rgba(255,255,255,0.85)')
    .style('font-size', '9px')
    .style('pointer-events', 'none');
  
  // Status badge
  cell.append('text').attr('x', 5).attr('y', 82)
    .text(d => d.data.status)
    .attr('fill', 'rgba(255,255,255,0.85)')
    .style('font-size', '9px')
    .style('font-weight', '600')
    .style('pointer-events', 'none');
}
</script>
</body>
</html>
